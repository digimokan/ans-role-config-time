- name: "Set systemd-timesyncd primary NTP servers in {{ config_time_timesyncd_conf_file }}"
  lineinfile:
    path: "{{ config_time_timesyncd_conf_file }}"
    regexp: >-
      ^#?NTP=
    line: >-
      NTP={{ config_time_primary_ntp_servers }}
    state: present
  notify: "restart-systemd-timesyncd"
  become: true
  become_user: root

- name: "Set systemd-timesyncd fallback NTP servers in {{ config_time_timesyncd_conf_file }}"
  lineinfile:
    path: "{{ config_time_timesyncd_conf_file }}"
    regexp: >-
      ^#?FallbackNTP=
    line: >-
      FallbackNTP={{ config_time_fallback_ntp_servers }}
    state: present
  notify: "restart-systemd-timesyncd"
  become: true
  become_user: root

- name: "Start and enable systemd-timesyncd"
  service:
    name: systemd-timesyncd
    state: started
    enabled: yes
  become: true
  become_user: root

